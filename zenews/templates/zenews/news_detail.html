{% extends "base.html" %}
{% load markup %}

{% block title %}{{ block.super }} | {{ object.title }}{% endblock %}
{% block main %}
<div class="post">
  <div class="headetail">
    <h2 class="title">{{ object.title }}</h2>
    <div class="info">时间：{{ object.pub_date|date:"Y年n月j日"}} | 编辑：{{ object.author }} | 来源：{{ object.source }}</div>
  </div>
<div class="news">{{ object.body_html|safe }}
    <p class="post-tags">
    {% if tag_list %}
    标签:
    {% for tag in tag_list %}
    <a href="{% url 'zenews_news_by_tag' tag.slug %}">{{ tag.name }}</a>
    {% endfor %}
    {% endif %}
    </p>
</div>

   <div class="meta">
   {% load comments i18n %}
   {% get_comment_count for object as comment_count %}
   {% if comment_count %}
    <span class="comments">已有{{ comment_count }}个评论</span>
   {% else %}
    <span class="comments">还没有评论</span>
   {% endif %}
    <span class="categories">
    {% if object.categories.count %}
    Categories:
    {% for category in object.categories.all %}
    <a href="{% url 'zenews_news_list' category.slug %}">{{ category.title }}</a>
    {% if forloop.last %}{% else %} |{% endif %}
    {% endfor %}
    {% endif %}
    </span>   
    </div>

<div id="comments">
<h2>{{ comment_count }} Responses to "{{ object.title }}"</h2>
<ol class="commentlist">
{% get_comment_list for object as comment_list %}
{% for comment in comment_list %}
<li class="{% cycle 'odd' 'even' %}">
<p><a href="{{comment.user_url}}">{{ comment.name }}</a> {{comment.submit_date|date:"Y年n月j日"}}</p>
{{ comment.comment|markdown:"safe"}}
</li>
{% empty %}
<li><p>目前还没有评论。</p></li>
{% endfor %}
</ol>
</div>

<div class="comment-form">
<h2>发表评论</h2>
{% get_comment_form for object as form %}
<form action="{% comment_form_target %}" method="post">{% csrf_token %}
  {% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}
  {% for field in form %}
    {% if field.is_hidden %}
      {{ field }}
    {% else %}
      {% if field.errors %}{{ field.errors }}{% endif %}
      <p
        {% if field.errors %} class="error"{% endif %}
        {% ifequal field.name "honeypot" %} style="display:none;"{% endifequal %}>
        {% ifequal field.name "comment" %}{{field}}{% else %}
        {{ field }}&nbsp;&nbsp;{{ field.label_tag }}{% endifequal %}
      </p>
    {% endif %}
  {% endfor %}
  <p class="submit">
    <input type="submit" name="post" class="submit-post" value="{% trans "Post" %}" />
  </p>
</form>

</div>
</div>
{% endblock %}

{% block side %}
    <ul>
        <li>
        <h2>搜索</h2>
        	<form id="searchform" method="get" action="">
		    <input type="text" name="s" id="s" class="textbox" value="" />
	     	<input id="btnSearch" type="submit" name="submit" value="Go" />
	        </form>
        </li> 
    </ul>
{% endblock %}

{% block jslink %}
<script src="{{ MEDIA_URL }}js/jquery-1.4.3.min.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}ajaxcomments/js/post-comment.js" type="text/javascript"></script>
<script>
$(document).ready(function() {
    // Customize the location of the media to match your project structure
    media = 'http://localhost:8000/sitemedia/ajaxcomments'
    
    // Customize the selector for your project
    $('div.comment-form form').submit(function() {
        ajaxComment({'media': media});
        return false;
    });
});
</script>
{% endblock %}
